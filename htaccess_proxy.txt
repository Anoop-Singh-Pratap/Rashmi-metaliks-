# ==============================================================================
# Apache Server Configuration for React/Node.js App
# ==============================================================================

# Enable the rewrite engine
RewriteEngine On
RewriteBase /

# ------------------------------------------------------------------------------
# Rule 1: Reverse Proxy for API requests using ProxyPass
# ------------------------------------------------------------------------------
# This is a more direct way to proxy and avoids RewriteRule interference.
# It requires mod_proxy and mod_proxy_http to be enabled.

<IfModule mod_proxy.c>
  ProxyPreserveHost On
  ProxyRequests Off
  ProxyPass /api/ http://localhost:3001/api/
  ProxyPassReverse /api/ http://localhost:3001/api/
</IfModule>

# ------------------------------------------------------------------------------
# Rule 2: Frontend Routing for React App (Single Page Application)
# ------------------------------------------------------------------------------
# This rule handles client-side routing. If a requested file or directory
# does not exist, it serves the main index.html file.

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Ensure the request is NOT for the API, to avoid conflicts with the proxy.
RewriteCond %{REQUEST_URI} !^/api
RewriteRule . /index.html [L]

# ------------------------------------------------------------------------------
# cPanel PHP Handler (Do not edit)
# ------------------------------------------------------------------------------
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php81 .php .php8 .phtml
</IfModule> 