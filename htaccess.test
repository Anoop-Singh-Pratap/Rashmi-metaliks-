# ==============================================================================
# Apache Server Configuration for React/Node.js App (Safe Version)
# ==============================================================================

# Enable the rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # ------------------------------------------------------------------------------
    # Rule 1: Proxy API requests to Node.js backend
    # ------------------------------------------------------------------------------
    # This rule forwards any request starting with /api/ to the backend.
    # The [P] flag indicates a proxy request. This requires mod_proxy and
    # mod_proxy_http to be enabled. The additional headers are a robust
    # way to handle SSL termination at the proxy.

    RewriteCond %{REQUEST_URI} ^/api/ [NC]
    RewriteRule ^api/(.*)$ http://localhost:3001/api/$1 [P,L]

    # ------------------------------------------------------------------------------
    # Rule 2: Frontend Routing for React App (Single Page Application)
    # ------------------------------------------------------------------------------
    # This rule handles client-side routing. If a requested file or directory
    # does not exist, it serves index.html.

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    # Make sure we don't rewrite the API calls
    RewriteCond %{REQUEST_URI} !^/api/
    RewriteRule . /index.html [L]
</IfModule>

# ------------------------------------------------------------------------------
# cPanel PHP Handler (Do not edit)
# ------------------------------------------------------------------------------
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php81 .php .php8 .phtml
</IfModule> 